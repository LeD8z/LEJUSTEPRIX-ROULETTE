<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram Shop App</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <!-- Lucide React -->
  <script type="module">
    import * as lucide from 'https://cdn.jsdelivr.net/npm/lucide-react@0.259.0/dist/esm/index.js';
    window.lucide = lucide;
  </script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <div id="root"></div>

  <script type="module">
    const { useState } = React;
    const { ShoppingCart, ChevronLeft, Sparkles, Coins, Gem, Crown, Scroll } = window.lucide;

    function TelegramShopApp() {
      const [currentView, setCurrentView] = useState('home');
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [selectedProduct, setSelectedProduct] = useState(null);
      const [selectedQuantity, setSelectedQuantity] = useState(null);
      const [bulkQuantity, setBulkQuantity] = useState(100);
      const [isBulkMode, setIsBulkMode] = useState(false);
      const [showBulkSection, setShowBulkSection] = useState(false);
      const [deliveryAddress, setDeliveryAddress] = useState('');
      const [isPriorityDelivery, setIsPriorityDelivery] = useState(false);

      const TELEGRAM_USERNAME = '@Aladin_870';
      const TELEGRAM_CHANNEL = 'https://t.me/+zXPeOM38QjszYzdk';

      const categories = [
        { id: 'weed', name: 'Weed', emoji: 'üåø' },
        { id: 'mousse', name: 'Jaune Mousseux', emoji: 'üí®' },
        { id: 'frozen', name: 'Frozen', emoji: '‚ùÑÔ∏è' },
        { id: 'filtrer', name: 'Filtrer', emoji: 'üî•' },
        { id: 'static', name: 'Static Premium', emoji: '‚ö°' }
      ];

      const quantityOptions = {
        weed: [ { amount: 1.4, price: 10, label: '1.4g' }, { amount: 25, price: 150, label: '25g' } ],
        mousse: [ { amount: 2.3, price: 10, label: '2.3g' } ],
        frozen: [ { amount: 0.5, price: 30, label: '0.5g' } ],
        filtrer: [ { amount: 1, price: 25, label: '1g' } ],
        static: [ { amount: 1.2, price: 10, label: '1.2g' } ]
      };

      const products = {
        weed: [{ id: 1, name: 'Weed Premium', description: 'Weed Premium - Tr√©sor ancestral' }],
        mousse: [{ id: 2, name: 'Jaune Mousseux', description: 'Jaune Mousseux - Texture mystique' }],
        frozen: [{ id: 3, name: 'Frozen Premium', description: 'Whiteüíé - Puret√© l√©gendaire' }],
        filtrer: [{ id: 4, name: 'Filtrer Premium', description: 'Filtrer - Qualit√© supr√™me' }],
        static: [{ id: 5, name: 'Static Premium', description: 'Static Premium - Qualit√© supr√™me' }]
      };

      const handleCategoryClick = (categoryId) => {
        setSelectedCategory(categoryId);
        const categoryProducts = products[categoryId] || [];
        if(categoryProducts.length > 0){
          setSelectedProduct(categoryProducts[0]);
          setSelectedQuantity(null);
          setCurrentView('product-detail');
        }
      };

      const handleOrder = () => {
        if(!selectedQuantity && !isBulkMode) return;
        const finalQuantity = isBulkMode ? bulkQuantity : selectedQuantity.amount;
        const finalPrice = isBulkMode ? finalQuantity * 4 : selectedQuantity.price;
        const totalPrice = isPriorityDelivery ? finalPrice + 5 : finalPrice;

        const message = `üè∫ *NOUVELLE COMMANDE*\nProduit: ${selectedProduct.name}\nQuantit√©: ${finalQuantity}g\nPrix: ${totalPrice}‚Ç¨\nAdresse: ${deliveryAddress || 'Non renseign√©e'}`;
        const telegramUrl = `https://t.me/${TELEGRAM_USERNAME}?text=${encodeURIComponent(message)}`;
        window.open(telegramUrl, '_blank');
      };

      const renderHome = () => (
        <div className="p-6">
          <h1 className="text-3xl font-bold mb-4">La Taverne de Limoges</h1>
          <div className="grid grid-cols-3 gap-3">
            {categories.map(cat => (
              <button key={cat.id} className="p-4 rounded-xl bg-amber-700" onClick={() => handleCategoryClick(cat.id)}>
                <div className="text-2xl">{cat.emoji}</div>
                <span>{cat.name}</span>
              </button>
            ))}
          </div>
        </div>
      );

      const renderProductDetail = () => {
        const options = quantityOptions[selectedCategory] || [];
        return (
          <div className="p-6">
            <button className="mb-4 p-2 bg-gray-700 rounded" onClick={() => setCurrentView('home')}>‚Üê Retour</button>
            <h2 className="text-2xl font-bold mb-2">{selectedProduct.name}</h2>
            <p className="mb-4">{selectedProduct.description}</p>
            <div className="grid grid-cols-2 gap-3 mb-4">
              {options.map((opt, i) => (
                <button key={i} className="p-3 rounded bg-yellow-600" onClick={() => { setSelectedQuantity(opt); setIsBulkMode(false); }}>
                  {opt.label} - {opt.price}‚Ç¨
                </button>
              ))}
            </div>
            <textarea 
              placeholder="Adresse de livraison" 
              className="w-full p-2 rounded mb-3 text-black"
              value={deliveryAddress}
              onChange={e => setDeliveryAddress(e.target.value)}
            />
            <div className="flex items-center gap-3 mb-3">
              <input type="checkbox" checked={isPriorityDelivery} onChange={() => setIsPriorityDelivery(!isPriorityDelivery)} />
              <span>Livraison Prioritaire (+5‚Ç¨)</span>
            </div>
            <button className="p-3 bg-green-600 rounded w-full" onClick={handleOrder}>
              <ShoppingCart className="inline w-5 h-5 mr-2" /> Commander
            </button>
          </div>
        );
      };

      return currentView === 'home' ? renderHome() : renderProductDetail();
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(TelegramShopApp));
  </script>
</body>
</html>
