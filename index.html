<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram Shop App</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel pour JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Lucide Icons -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/lucide.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    const { ShoppingCart, ChevronLeft, Sparkles, Coins, Gem, Crown, Scroll } = lucideIcons;


    function TelegramShopApp() {
      const [view, setView] = useState('home');
      const [category, setCategory] = useState(null);
      const [product, setProduct] = useState(null);
      const [quantity, setQuantity] = useState(null);
      const [bulk, setBulk] = useState(100);
      const [bulkMode, setBulkMode] = useState(false);
      const [showBulk, setShowBulk] = useState(false);
      const [address, setAddress] = useState('');
      const [priority, setPriority] = useState(false);

      const TELEGRAM_USERNAME = '@Aladin_870';

      const categories = [
        { id: 'weed', name: 'Weed', emoji: 'üåø' },
        { id: 'mousse', name: 'Jaune Mousseux', emoji: 'üí®' },
        { id: 'frozen', name: 'Frozen', emoji: '‚ùÑÔ∏è' },
        { id: 'filtrer', name: 'Filtrer', emoji: 'üî•' },
        { id: 'static', name: 'Static Premium', emoji: '‚ö°' }
      ];

      const products = {
        weed: [{ name: 'Weed Premium', description: 'Tr√©sor ancestral', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }],
        mousse: [{ name: 'Jaune Mousseux', description: 'Texture mystique', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }],
        frozen: [{ name: 'Frozen Premium', description: 'Puret√© l√©gendaire', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }],
        filtrer: [{ name: 'Filtrer Premium', description: 'Qualit√© supr√™me', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }],
        static: [{ name: 'Static Premium', description: 'Qualit√© supr√™me', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }]
      };

      const quantityOptions = {
        weed: [{ amount: 1.4, price: 10, label: '1.4g' }, { amount: 2.8, price: 20, label: '2.8g' }],
        mousse: [{ amount: 2.3, price: 10, label: '2.3g' }, { amount: 4.6, price: 20, label: '4.6g' }],
        frozen: [{ amount: 0.5, price: 30, label: '0.5g' }, { amount: 1, price: 50, label: '1g' }],
        filtrer: [{ amount: 1, price: 25, label: '1g' }, { amount: 3, price: 70, label: '3g' }],
        static: [{ amount: 1.2, price: 10, label: '1.2g' }, { amount: 2.4, price: 20, label: '2.4g' }]
      };

      const handleCategory = (id) => {
        setCategory(id);
        setProduct(products[id][0]);
        setQuantity(null);
        setView('product');
      };

      const calcBulkPrice = (g) => {
        const base = category === 'weed' ? 4.5 : category === 'mousse' ? 3.5 : 2;
        return Math.round(g * base);
      };

      const handleOrder = () => {
        if (!quantity && !bulkMode) return;
        const finalQty = bulkMode ? bulk : quantity.amount;
        const finalPrice = bulkMode ? calcBulkPrice(bulk) : quantity.price;
        const totalPrice = priority ? finalPrice + 5 : finalPrice;
        const message = `Commande: ${product.name}\nQuantit√©: ${finalQty}\nPrix: ${totalPrice}‚Ç¨\nAdresse: ${address || 'Non renseign√©e'}`;
        const telegramUrl = `https://t.me/${TELEGRAM_USERNAME}?text=${encodeURIComponent(message)}`;
        window.open(telegramUrl, '_blank');
      };

      const Home = () => (
        <div className="p-6 text-center">
          <h1 className="text-3xl font-bold mb-4">La Taverne de Limoges</h1>
          <p className="mb-6">Choisissez une cat√©gorie :</p>
          <div className="grid grid-cols-3 gap-4 max-w-md mx-auto">
            {categories.map(cat => (
              <button key={cat.id} onClick={() => handleCategory(cat.id)} className="p-4 rounded bg-gray-700 hover:bg-gray-600 transition transform hover:scale-105">
                <div className="text-2xl mb-1">{cat.emoji}</div>
                <span>{cat.name}</span>
              </button>
            ))}
          </div>
        </div>
      );

      const ProductDetail = () => {
        const options = quantityOptions[category] || [];
        return (
          <div className="p-6 max-w-md mx-auto">
            <button onClick={() => setView('home')} className="mb-4 flex items-center gap-2 p-2 bg-gray-700 rounded hover:bg-gray-600">
              <ChevronLeft size={20}/> Retour
            </button>
            <h2 className="text-2xl font-bold mb-2">{product.name}</h2>
            <p className="mb-4">{product.description}</p>
            <video controls className="w-full rounded mb-4">
              <source src={product.video} type="video/mp4"/>
            </video>

            {!bulkMode && (
              <div className="grid grid-cols-2 gap-2 mb-4">
                {options.map(opt => (
                  <button key={opt.label} onClick={() => setQuantity(opt)} className={`p-3 rounded ${quantity === opt ? 'bg-green-600' : 'bg-gray-700'} hover:scale-105 transition`}>
                    {opt.label} - {opt.price}‚Ç¨
                  </button>
                ))}
              </div>
            )}

            {showBulk && (
              <div className="mb-4">
                <label className="block mb-1">Quantit√© en g (bulk)</label>
                <input type="number" value={bulk} onChange={e => setBulk(Number(e.target.value))} className="w-full p-2 rounded text-black"/>
                <p>Prix estim√©: {calcBulkPrice(bulk)}‚Ç¨</p>
              </div>
            )}

            <div className="mb-2">
              <input type="text" placeholder="Adresse de livraison" value={address} onChange={e => setAddress(e.target.value)} className="w-full p-2 rounded text-black"/>
            </div>
            <label className="flex items-center gap-2 mb-4">
              <input type="checkbox" checked={priority} onChange={() => setPriority(!priority)} />
              Livraison Prioritaire (+5‚Ç¨)
            </label>

            <button onClick={handleOrder} className="w-full p-4 rounded bg-green-600 hover:scale-105 transition flex items-center justify-center gap-2 mb-2">
              <ShoppingCart size={20}/> Commander
            </button>

            <button onClick={() => { setBulkMode(!bulkMode); setShowBulk(true); }} className="w-full p-3 rounded bg-yellow-600 hover:scale-105 transition flex items-center justify-center gap-2">
              {bulkMode ? 'Mode normal' : 'Mode Bulk'}
            </button>
          </div>
        );
      };

      return (
        <div>
          {view === 'home' && <Home />}
          {view === 'product' && <ProductDetail />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<TelegramShopApp />);
  </script>
</body>
</html>
