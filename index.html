<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram Shop App</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel CDN pour JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Lucide Icons CDN -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/lucide.min.js"></script>
</head>
<body class="bg-gray-900 font-sans text-white">
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    const { ShoppingCart, ChevronLeft, Sparkles, Coins, Gem, Crown, Scroll } = lucide;

    function TelegramShopApp() {
      const [currentView, setCurrentView] = useState('home');
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [selectedProduct, setSelectedProduct] = useState(null);
      const [selectedQuantity, setSelectedQuantity] = useState(null);
      const [bulkQuantity, setBulkQuantity] = useState(100);
      const [isBulkMode, setIsBulkMode] = useState(false);
      const [showBulkSection, setShowBulkSection] = useState(false);
      const [deliveryAddress, setDeliveryAddress] = useState('');
      const [isPriorityDelivery, setIsPriorityDelivery] = useState(false);

      // Telegram config
      const TELEGRAM_USERNAME = '@Aladin_870';
      const TELEGRAM_CHANNEL = 'https://t.me/+zXPeOM38QjszYzdk';

      const categories = [
        { id: 'weed', name: 'Weed', emoji: 'üåø' },
        { id: 'mousse', name: 'Jaune Mousseux', emoji: 'üí®' },
        { id: 'frozen', name: 'Frozen', emoji: '‚ùÑÔ∏è' },
        { id: 'filtrer', name: 'Filtrer', emoji: 'üî•' },
        { id: 'static', name: 'Static Premium', emoji: '‚ö°' }
      ];

      const quantityOptions = {
        weed: [
          { amount: 1.4, price: 10, label: '1.4g' },
          { amount: 2.8, price: 20, label: '2.8g' },
          { amount: 4.5, price: 30, label: '4.5g' },
          { amount: 11, price: 70, label: '11g' },
          { amount: 25, price: 150, label: '25g' },
          { amount: 50, price: 240, label: '50g' },
          { amount: 100, price: 450, label: '100g', treasure: true }
        ],
        mousse: [
          { amount: 2.3, price: 10, label: '2.3g' },
          { amount: 4.6, price: 20, label: '4.6g' },
          { amount: 10, price: 50, label: '10g' },
          { amount: 25, price: 110, label: '25g' },
          { amount: 50, price: 200, label: '50g' },
          { amount: 100, price: 350, label: '100g', treasure: true }
        ],
        frozen: [
          { amount: 0.5, price: 30, label: '0.5g' },
          { amount: 1, price: 50, label: '1g' },
          { amount: 2, price: 100, label: '2g' },
          { amount: 5, price: 250, label: '5g', treasure: true },
          { amount: 10, price: 450, label: '10g' }
        ],
        filtrer: [
          { amount: 1, price: 25, label: '1g' },
          { amount: 3, price: 70, label: '3g' },
          { amount: 5, price: 110, label: '5g' },
          { amount: 10, price: 200, label: '10g', treasure: true }
        ],
        static: [
          { amount: 1.2, price: 10, label: '1.2g' },
          { amount: 2.4, price: 20, label: '2.4g' },
          { amount: 5, price: 40, label: '5g' },
          { amount: 10, price: 80, label: '10g' },
          { amount: 25, price: 180, label: '25g' },
          { amount: 50, price: 300, label: '50g' },
          { amount: 100, price: 550, label: '100g', treasure: true }
        ]
      };

      const products = {
        weed: [{ id: 5, name: 'Weed Premium', description: 'Weed Premium - Tr√©sor ancestral', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }],
        mousse: [{ id: 4, name: 'Jaune Mousseux', description: 'Jaune Mousseux - Texture mystique', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }],
        frozen: [{ id: 1, name: 'Frozen Premium', description: 'Whiteüíé - Puret√© l√©gendaire', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }],
        filtrer: [{ id: 6, name: 'Filtrer Premium', description: 'Filtrer - Qualit√© supr√™me', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }],
        static: [{ id: 7, name: 'Static Premium', description: 'Static Premium - Qualit√© supr√™me', video: 'https://www.w3schools.com/html/mov_bbb.mp4' }]
      };

      const handleCategoryClick = (categoryId) => {
        setSelectedCategory(categoryId);
        const categoryProducts = products[categoryId] || [];
        if (categoryProducts.length > 0) {
          setSelectedProduct(categoryProducts[0]);
          setSelectedQuantity(null);
          setCurrentView('product-detail');
        }
      };

      const calculateBulkPrice = (grams) => {
        const basePrice = selectedCategory === 'weed' ? 4.5 :
                          selectedCategory === 'mousse' ? 3.5 :
                          selectedCategory === 'frozen' ? 45 :
                          selectedCategory === 'filtrer' ? 2 :
                          selectedCategory === 'static' ? 2 : 4;
        return Math.round(grams * basePrice);
      };

      const handleOrder = () => {
        if (!selectedQuantity && !isBulkMode) return;
        const finalQuantity = isBulkMode ? bulkQuantity : selectedQuantity.amount;
        const finalPrice = isBulkMode ? calculateBulkPrice(bulkQuantity) : selectedQuantity.price;
        const finalLabel = isBulkMode ? `${bulkQuantity}g` : selectedQuantity.label;
        const totalPrice = isPriorityDelivery ? finalPrice + 5 : finalPrice;

        const message = `üè∫ *NOUVELLE COMMANDE*\n\nProduit: ${selectedProduct.name}\nQuantit√©: ${finalLabel}\nPrix: ${finalPrice}‚Ç¨\n${isPriorityDelivery ? 'Livraison Prioritaire: +5‚Ç¨\n' : ''}Total: ${totalPrice}‚Ç¨\nAdresse: ${deliveryAddress || 'Non renseign√©e'}`;
        const telegramUrl = `https://t.me/${TELEGRAM_USERNAME}?text=${encodeURIComponent(message)}`;
        navigator.clipboard.writeText(message).then(() => window.open(telegramUrl, '_blank'));
      };

      const handleReferral = () => {
        const referralMessage = `üéÅ Vous avez √©t√© Parrainez üéÅ\n1G gratuit sur votre premi√®re commande !\nüëâ ${TELEGRAM_CHANNEL}`;
        const telegramShareUrl = `https://t.me/share/url?url=${encodeURIComponent(TELEGRAM_CHANNEL)}&text=${encodeURIComponent(referralMessage)}`;
        window.open(telegramShareUrl, '_blank');
      };

      const renderHome = () => (
        <div className="p-6 text-center">
          <h1 className="text-3xl font-bold mb-6">La Taverne de Limoges</h1>
          <div className="grid grid-cols-3 gap-4 max-w-md mx-auto mb-6">
            {categories.map(cat => (
              <button key={cat.id} onClick={() => handleCategoryClick(cat.id)} className="p-4 rounded bg-amber-600 hover:scale-105 transition">
                <div className="text-2xl">{cat.emoji}</div>
                <span>{cat.name}</span>
              </button>
            ))}
          </div>
          <div className="space-y-3 max-w-md mx-auto">
            <button onClick={handleReferral} className="w-full p-4 rounded bg-yellow-500 hover:scale-105 transition">Parrainez un Ami = 1g offert</button>
            <button className="w-full p-4 rounded bg-gray-700 hover:scale-105 transition">Contacter le Support</button>
          </div>
        </div>
      );

      const renderProductDetail = () => {
        const options = quantityOptions[selectedCategory] || [];
        return (
          <div className="p-6">
            <button onClick={() => setCurrentView('home')} className="mb-4 p-2 rounded bg-gray-700 flex items-center gap-2">
              <ChevronLeft size={20}/> Retour
            </button>
            <h2 className="text-2xl font-bold">{selectedProduct?.name}</h2>
            <p className="mb-4">{selectedProduct?.description}</p>
            <video controls className="w-full max-w-md rounded mb-4">
              <source src={selectedProduct?.video} type="video/mp4"/>
            </video>

            {!isBulkMode && (
              <div className="grid grid-cols-2 gap-2 mb-4">
                {options.map(opt => (
                  <button key={opt.label} onClick={() => setSelectedQuantity(opt)} className={`p-3 rounded ${selectedQuantity === opt ? 'bg-green-600' : 'bg-gray-700'} hover:scale-105 transition`}>
                    {opt.label} {opt.treasure ? <Sparkles size={16}/> : ''} - {opt.price}‚Ç¨
                  </button>
                ))}
              </div>
            )}

            {showBulkSection && (
              <div className="mb-4">
                <label className="block mb-1">Quantit√© en g (bulk)</label>
                <input type="number" value={bulkQuantity} onChange={e => setBulkQuantity(Number(e.target.value))} className="w-full p-2 rounded text-black"/>
                <p>Prix estim√©: {calculateBulkPrice(bulkQuantity)}‚Ç¨</p>
              </div>
            )}

            <div className="flex gap-2 mb-4">
              <button onClick={() => setIsBulkMode(!isBulkMode)} className="p-3 rounded bg-yellow-500 hover:scale-105 transition">Mode Bulk</button>
              <button onClick={() => setShowBulkSection(!showBulkSection)} className="p-3 rounded bg-blue-500 hover:scale-105 transition">Afficher Bulk</button>
            </div>

            <input type="text" placeholder="Adresse de livraison" value={deliveryAddress} onChange={e => setDeliveryAddress(e.target.value)} className="w-full p-2 mb-2 rounded text-black"/>
            <label className="flex items-center gap-2 mb-4">
              <input type="checkbox" checked={isPriorityDelivery} onChange={() => setIsPriorityDelivery(!isPriorityDelivery)} />
              Livraison Prioritaire (+5‚Ç¨)
            </label>

            <button onClick={handleOrder} className="w-full p-4 rounded bg-green-600 hover:scale-105 transition flex items-center justify-center gap-2">
              <ShoppingCart size={20}/> Commander
            </button>
          </div>
        );
      };

      return (
        <div>
          {currentView === 'home' && renderHome()}
          {currentView === 'product-detail' && renderProductDetail()}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<TelegramShopApp />);
  </script>
</body>
</html>
