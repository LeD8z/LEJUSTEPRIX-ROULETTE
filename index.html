<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>La Taverne de Limoges</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React + ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Lucide React Icons CDN -->
  <script type="module">
    import * as LucideIcons from 'https://cdn.jsdelivr.net/npm/lucide-react@0.230.0/dist/esm/lucide-react.js';
    window.LucideIcons = LucideIcons;
  </script>
</head>
<body class="bg-gray-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    const { ShoppingCart, ChevronLeft, Sparkles, Coins, Gem, Crown, Scroll } = window.LucideIcons;

    const TelegramShopApp = () => {
      const [currentView, setCurrentView] = useState('home');
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [selectedProduct, setSelectedProduct] = useState(null);
      const [selectedQuantity, setSelectedQuantity] = useState(null);
      const [bulkQuantity, setBulkQuantity] = useState(100);
      const [isBulkMode, setIsBulkMode] = useState(false);
      const [showBulkSection, setShowBulkSection] = useState(false);
      const [deliveryAddress, setDeliveryAddress] = useState('');
      const [isPriorityDelivery, setIsPriorityDelivery] = useState(false);

      const TELEGRAM_USERNAME = '@Aladin_870';
      const TELEGRAM_CHANNEL = 'https://t.me/+zXPeOM38QjszYzdk';

      const categories = [
        { id: 'weed', name: 'Weed', emoji: 'ðŸŒ¿', gradient: 'from-amber-700 via-green-800 to-emerald-900', shadow: 'shadow-green-900/70', glow: 'shadow-[0_0_30px_rgba(34,197,94,0.3)]' },
        { id: 'mousse', name: 'Jaune Mousseux', emoji: 'ðŸ’¨', gradient: 'from-stone-700 via-amber-800 to-yellow-900', shadow: 'shadow-amber-900/70', glow: 'shadow-[0_0_30px_rgba(217,119,6,0.3)]' },
        { id: 'frozen', name: 'Frozen', emoji: 'â„ï¸', gradient: 'from-slate-700 via-cyan-900 to-blue-900', shadow: 'shadow-cyan-900/70', glow: 'shadow-[0_0_30px_rgba(6,182,212,0.3)]' },
        { id: 'filtrer', name: 'Filtrer', emoji: 'ðŸ”¥', gradient: 'from-red-900 via-orange-800 to-amber-900', shadow: 'shadow-red-900/70', glow: 'shadow-[0_0_30px_rgba(220,38,38,0.3)]' },
        { id: 'static', name: 'Static Premium', emoji: 'âš¡', gradient: 'from-gray-800 via-gray-700 to-gray-900', shadow: 'shadow-gray-900/70', glow: 'shadow-[0_0_30px_rgba(107,114,128,0.3)]' }
      ];

      const quantityOptions = {
        weed: [ { amount: 1.4, price: 10, label: '1.4g' }, { amount: 2.8, price: 20, label: '2.8g' }, { amount: 4.5, price: 30, label: '4.5g' }, { amount: 11, price: 70, label: '11g' }, { amount: 25, price: 150, label: '25g' }, { amount: 50, price: 240, label: '50g' }, { amount: 100, price: 450, label: '100g', treasure: true } ],
        mousse: [ { amount: 2.3, price: 10, label: '2.3g' }, { amount: 4.6, price: 20, label: '4.6g' }, { amount: 10, price: 50, label: '10g' }, { amount: 25, price: 110, label: '25g' }, { amount: 50, price: 200, label: '50g' }, { amount: 100, price: 350, label: '100g', treasure: true } ],
        frozen: [ { amount: 0.5, price: 30, label: '0.5g' }, { amount: 1, price: 50, label: '1g' }, { amount: 2, price: 100, label: '2g' }, { amount: 5, price: 250, label: '5g', treasure: true }, { amount: 10, price: 450, label: '10g' } ],
        filtrer: [ { amount: 1, price: 25, label: '1g' }, { amount: 3, price: 70, label: '3g' }, { amount: 5, price: 110, label: '5g' }, { amount: 10, price: 200, label: '10g', treasure: true } ],
        static: [ { amount: 1.2, price: 10, label: '1.2g' }, { amount: 2.4, price: 20, label: '2.4g' }, { amount: 5, price: 40, label: '5g' }, { amount: 10, price: 80, label: '10g' }, { amount: 25, price: 180, label: '25g' }, { amount: 50, price: 300, label: '50g' }, { amount: 100, price: 550, label: '100g', treasure: true } ]
      };

      const products = {
        frozen: [ { id: 1, name: 'Frozen Premium', description: 'WhiteðŸ’Ž - PuretÃ© lÃ©gendaire', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'ðŸ’Ž Rare' } ],
        mousse: [ { id: 4, name: 'Jaune Mousseux', description: 'Jaune Mousseux - Texture mystique', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'â­ DÃ©fonce+' } ],
        weed: [ { id: 5, name: 'Weed Premium', description: 'Weed Premium - TrÃ©sor ancestral', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'ðŸ‘‘ Quality++' } ],
        filtrer: [ { id: 6, name: 'Filtrer Premium', description: 'Filtrer - QualitÃ© suprÃªme', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'ðŸ”¥ DÃ©fonce++' } ],
        static: [ { id: 7, name: 'Static Premium', description: 'Static Premium - QualitÃ© suprÃªme', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'âš¡ Premium' } ]
      };

      const getCaveGradient = (categoryId) => {
        const gradients = {
          weed: '#1a4d2e 0%, #2d5f3f 50%, #1a4d2e 100%',
          mousse: '#78350f 0%, #92400e 50%, #78350f 100%',
          frozen: '#1e3a5f 0%, #2d5a7e 50%, #1e3a5f 100%',
          filtrer: '#7c2d12 0%, #991b1b 50%, #7c2d12 100%',
          static: '#1f2937 0%, #374151 50%, #1f2937 100%'
        };
        return gradients[categoryId] || gradients.weed;
      };

      const handleCategoryClick = (categoryId) => {
        setSelectedCategory(categoryId);
        const categoryProducts = products[categoryId] || [];
        if (categoryProducts.length > 0) {
          setSelectedProduct(categoryProducts[0]);
          setSelectedQuantity(null);
          setCurrentView('product-detail');
        }
      };

      const calculateBulkPrice = (grams) => {
        const basePrice = selectedCategory === 'weed' ? 4.5 :
                          selectedCategory === 'mousse' ? 3.5 :
                          selectedCategory === 'frozen' ? 45 :
                          selectedCategory === 'filtrer' ? 2 :
                          selectedCategory === 'static' ? 2 : 4;
        return Math.round(grams * basePrice);
      };

      const handleOrder = () => {
        if (!selectedQuantity && !isBulkMode) return;
        const finalQuantity = isBulkMode ? bulkQuantity : selectedQuantity.amount;
        const finalPrice = isBulkMode ? calculateBulkPrice(bulkQuantity) : selectedQuantity.price;
        const finalLabel = isBulkMode ? `${bulkQuantity}g` : selectedQuantity.label;
        const totalPrice = isPriorityDelivery ? finalPrice + 5 : finalPrice;

        const message = `ðŸº *NOUVELLE COMMANDE*\n\nðŸ’Ž Produit: ${selectedProduct.name}\nâš–ï¸ QuantitÃ©: ${finalLabel}\nðŸ’° Prix produit: ${finalPrice}â‚¬\n${isPriorityDelivery ? 'âš¡ Livraison Prioritaire: +5â‚¬\n' : ''}ðŸ’³ Total: ${totalPrice}â‚¬\n\nðŸ“ Adresse de livraison:\n${deliveryAddress || 'Non renseignÃ©e'}\n\nQue la fortune vous accompagne !`;

        const encodedMessage = encodeURIComponent(message);
        const telegramUrl = `https://t.me/${TELEGRAM_USERNAME}?text=${encodedMessage}`;
        navigator.clipboard.writeText(message).then(() => window.open(telegramUrl, '_blank'));
      };

      const handleReferral = () => {
        const referralMessage = `ðŸŽ Vous avez Ã©tÃ© Parrainez ðŸŽ\n\nRejoins-nous et bÃ©nÃ©ficiez de 1G gratuit sur votre premiÃ¨re commande !\n\nðŸ’Ž QualitÃ© garantie\nâš¡ Livraison rapide\nðŸŽ 1G offert Ã  chaques Parrainage !\n\nðŸ‘‰ Cliquez ici : ${TELEGRAM_CHANNEL}`;
        const telegramShareUrl = `https://t.me/share/url?url=${encodeURIComponent(TELEGRAM_CHANNEL)}&text=${encodeURIComponent(referralMessage)}`;
        window.open(telegramShareUrl, '_blank');
      };

      const renderHome = () => (
        <div className="min-h-screen p-6 text-center">
          <h1 className="text-3xl font-bold text-yellow-400 mb-6">La Taverne de Limoges</h1>
          <div className="grid grid-cols-3 gap-4 max-w-md mx-auto">
            {categories.map(c => (
              <button key={c.id} className="p-4 rounded-xl bg-yellow-700 text-white" onClick={() => handleCategoryClick(c.id)}>
                <div className="text-2xl mb-2">{c.emoji}</div>
                <div>{c.name}</div>
              </button>
            ))}
          </div>
        </div>
      );

      const renderProductDetail = () => {
        const options = quantityOptions[selectedCategory] || [];
        return (
          <div className="min-h-screen p-6 text-center">
            <button className="mb-4 p-2 bg-gray-800 text-yellow-400 rounded" onClick={() => setCurrentView('home')}>
              <ChevronLeft className="w-5 h-5 inline" /> Retour
            </button>
            <h2 className="text-2xl font-bold text-yellow-400 mb-4">{selectedProduct.name}</h2>
            <video controls className="w-full max-w-md mx-auto rounded mb-4">
              <source src={selectedProduct.video} type="video/mp4" />
            </video>
            <p className="mb-4 text-yellow-200">{selectedProduct.description}</p>

            <div className="grid grid-cols-2 gap-2 max-w-md mx-auto mb-4">
              {options.map((opt, i) => (
                <button key={i} className="p-2 rounded bg-gray-700 text-yellow-400" onClick={() => setSelectedQuantity(opt)}>
                  {opt.label} - {opt.price}â‚¬
                </button>
              ))}
            </div>

            {(selectedQuantity || isBulkMode) && (
              <button className="p-4 rounded bg-yellow-600 text-gray-900 font-bold" onClick={handleOrder}>
                Commander {(isBulkMode ? bulkQuantity + 'g' : selectedQuantity.label)}
              </button>
            )}
          </div>
        );
      };

      return (
        <div>
          {currentView === 'home' && renderHome()}
          {currentView === 'product-detail' && renderProductDetail()}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<TelegramShopApp />);
  </script>
</body>
</html>
