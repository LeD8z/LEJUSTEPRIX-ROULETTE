<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram Shop App</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Lucide React CDN -->
  <script type="module">
    import * as Lucide from 'https://cdn.jsdelivr.net/npm/lucide-react@0.278.0/dist/esm/lucide-react.js';
    window.Lucide = Lucide;
  </script>
</head>
<body class="bg-gray-900">

<div id="root"></div>

<script type="text/javascript">
  const { useState } = React;
  const { ShoppingCart, ChevronLeft, Sparkles, Coins, Gem, Crown, Scroll } = window.Lucide;

  function TelegramShopApp() {
    const [currentView, setCurrentView] = useState('home');
    const [selectedCategory, setSelectedCategory] = useState(null);
    const [selectedProduct, setSelectedProduct] = useState(null);
    const [selectedQuantity, setSelectedQuantity] = useState(null);
    const [bulkQuantity, setBulkQuantity] = useState(100);
    const [isBulkMode, setIsBulkMode] = useState(false);
    const [showBulkSection, setShowBulkSection] = useState(false);
    const [deliveryAddress, setDeliveryAddress] = useState('');
    const [isPriorityDelivery, setIsPriorityDelivery] = useState(false);

    const TELEGRAM_USERNAME = '@Aladin_870';
    const TELEGRAM_CHANNEL = 'https://t.me/+zXPeOM38QjszYzdk';

    const categories = [
      { id: 'weed', name: 'Weed', emoji: 'ðŸŒ¿', gradient: 'from-amber-700 via-green-800 to-emerald-900', glow: 'shadow-[0_0_30px_rgba(34,197,94,0.3)]' },
      { id: 'mousse', name: 'Jaune Mousseux', emoji: 'ðŸ’¨', gradient: 'from-stone-700 via-amber-800 to-yellow-900', glow: 'shadow-[0_0_30px_rgba(217,119,6,0.3)]' },
      { id: 'frozen', name: 'Frozen', emoji: 'â„ï¸', gradient: 'from-slate-700 via-cyan-900 to-blue-900', glow: 'shadow-[0_0_30px_rgba(6,182,212,0.3)]' },
      { id: 'filtrer', name: 'Filtrer', emoji: 'ðŸ”¥', gradient: 'from-red-900 via-orange-800 to-amber-900', glow: 'shadow-[0_0_30px_rgba(220,38,38,0.3)]' },
      { id: 'static', name: 'Static Premium', emoji: 'âš¡', gradient: 'from-gray-800 via-gray-700 to-gray-900', glow: 'shadow-[0_0_30px_rgba(107,114,128,0.3)]' }
    ];

    const quantityOptions = {
      weed: [ { amount: 1.4, price: 10, label: '1.4g' }, { amount: 2.8, price: 20, label: '2.8g' }, { amount: 4.5, price: 30, label: '4.5g' }, { amount: 11, price: 70, label: '11g' }, { amount: 25, price: 150, label: '25g' }, { amount: 50, price: 240, label: '50g' }, { amount: 100, price: 450, label: '100g', treasure: true } ],
      mousse: [ { amount: 2.3, price: 10, label: '2.3g' }, { amount: 4.6, price: 20, label: '4.6g' }, { amount: 10, price: 50, label: '10g' }, { amount: 25, price: 110, label: '25g' }, { amount: 50, price: 200, label: '50g' }, { amount: 100, price: 350, label: '100g', treasure: true } ],
      frozen: [ { amount: 0.5, price: 30, label: '0.5g' }, { amount: 1, price: 50, label: '1g' }, { amount: 2, price: 100, label: '2g' }, { amount: 5, price: 250, label: '5g', treasure: true }, { amount: 10, price: 450, label: '10g' } ],
      filtrer: [ { amount: 1, price: 25, label: '1g' }, { amount: 3, price: 70, label: '3g' }, { amount: 5, price: 110, label: '5g' }, { amount: 10, price: 200, label: '10g', treasure: true } ],
      static: [ { amount: 1.2, price: 10, label: '1.2g' }, { amount: 2.4, price: 20, label: '2.4g' }, { amount: 5, price: 40, label: '5g' }, { amount: 10, price: 80, label: '10g' }, { amount: 25, price: 180, label: '25g' }, { amount: 50, price: 300, label: '50g' }, { amount: 100, price: 550, label: '100g', treasure: true } ]
    };

    const products = {
      frozen: [ { id: 1, name: 'Frozen Premium', description: 'WhiteðŸ’Ž - PuretÃ© lÃ©gendaire', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'ðŸ’Ž Rare' } ],
      mousse: [ { id: 4, name: 'Jaune Mousseux', description: 'Jaune Mousseux - Texture mystique', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'â­ DÃ©fonce+' } ],
      weed: [ { id: 5, name: 'Weed Premium', description: 'Weed Premium - TrÃ©sor ancestral', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'ðŸ‘‘ Quality++' } ],
      filtrer: [ { id: 6, name: 'Filtrer Premium', description: 'Filtrer - QualitÃ© suprÃªme', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'ðŸ”¥ DÃ©fonce++' } ],
      static: [ { id: 7, name: 'Static Premium', description: 'Static Premium - QualitÃ© suprÃªme', video: 'https://www.w3schools.com/html/mov_bbb.mp4', badge: 'âš¡ Premium' } ]
    };

    const handleCategoryClick = (categoryId) => {
      setSelectedCategory(categoryId);
      const categoryProducts = products[categoryId] || [];
      if (categoryProducts.length > 0) {
        setSelectedProduct(categoryProducts[0]);
        setSelectedQuantity(null);
        setCurrentView('product-detail');
      }
    };

    const calculateBulkPrice = (grams) => {
      const basePrice = selectedCategory === 'weed' ? 4.5 :
                        selectedCategory === 'mousse' ? 3.5 :
                        selectedCategory === 'frozen' ? 45 :
                        selectedCategory === 'filtrer' ? 2 :
                        selectedCategory === 'static' ? 2 : 4;
      return Math.round(grams * basePrice);
    };

    const handleOrder = () => {
      if (!selectedQuantity && !isBulkMode) return;
      const finalQuantity = isBulkMode ? bulkQuantity : selectedQuantity.amount;
      const finalPrice = isBulkMode ? calculateBulkPrice(bulkQuantity) : selectedQuantity.price;
      const finalLabel = isBulkMode ? `${bulkQuantity}g` : selectedQuantity.label;
      const totalPrice = isPriorityDelivery ? finalPrice + 5 : finalPrice;

      const message = `ðŸº *NOUVELLE COMMANDE*\n\nðŸ’Ž Produit: ${selectedProduct.name}\nâš–ï¸ QuantitÃ©: ${finalLabel}\nðŸ’° Prix produit: ${finalPrice}â‚¬\n${isPriorityDelivery ? 'âš¡ Livraison Prioritaire: +5â‚¬\n' : ''}ðŸ’³ Total: ${totalPrice}â‚¬\n\nðŸ“ Adresse de livraison:\n${deliveryAddress || 'Non renseignÃ©e'}\n\nQue la fortune vous accompagne !`;

      const encodedMessage = encodeURIComponent(message);
      const telegramUrl = `https://t.me/${TELEGRAM_USERNAME}?text=${encodedMessage}`;
      navigator.clipboard.writeText(message).then(() => { window.open(telegramUrl, '_blank'); });
    };

    const handleReferral = () => {
      const referralMessage = `ðŸŽ Vous avez Ã©tÃ© Parrainez ðŸŽ\n\nRejoins-nous et bÃ©nÃ©ficiez de 1G gratuit sur votre premiÃ¨re commande !\nðŸ’Ž QualitÃ© garantie\nâš¡ Livraison rapide\nðŸŽ 1G offert Ã  chaques Parrainage !\n\nðŸ‘‰ Cliquez ici : ${TELEGRAM_CHANNEL}`;
      const telegramShareUrl = `https://t.me/share/url?url=${encodeURIComponent(TELEGRAM_CHANNEL)}&text=${encodeURIComponent(referralMessage)}`;
      window.open(telegramShareUrl, '_blank');
    };

    const getCaveGradient = (categoryId) => {
      const gradients = { weed: '#1a4d2e 0%, #2d5f3f 50%, #1a4d2e 100%', mousse: '#78350f 0%, #92400e 50%, #78350f 100%', frozen: '#1e3a5f 0%, #2d5a7e 50%, #1e3a5f 100%', filtrer: '#7c2d12 0%, #991b1b 50%, #7c2d12 100%', static: '#1f2937 0%, #374151 50%, #1f2937 100%' };
      return gradients[categoryId] || gradients.weed;
    };

    // --- Rendu de la page Home (simplifiÃ©) ---
    const renderHome = () => (
      React.createElement('div', { className: 'min-h-screen p-6 text-center text-amber-100' },
        React.createElement('h1', { className: 'text-3xl font-bold mb-6' }, 'La Taverne de Limoges'),
        React.createElement('div', { className: 'grid grid-cols-3 gap-3 max-w-lg mx-auto' },
          categories.map(cat =>
            React.createElement('button', { key: cat.id, className: 'p-4 rounded-2xl bg-gray-700 hover:scale-105 transition', onClick: () => handleCategoryClick(cat.id) },
              cat.emoji, React.createElement('br', null), cat.name
            )
          )
        ),
        React.createElement('button', { className: 'mt-6 p-4 rounded-xl bg-yellow-600', onClick: handleReferral }, 'Parrainez un Ami = 1g offert')
      )
    );

    // --- Rendu de la page Product Detail (simplifiÃ©) ---
    const renderProductDetail = () => (
      React.createElement('div', { className: 'min-h-screen p-5 text-amber-100' },
        React.createElement('button', { className: 'p-2 rounded bg-gray-700 mb-4', onClick: () => setCurrentView('home') }, React.createElement(ChevronLeft, { className: 'w-5 h-5' }), ' Retour'),
        React.createElement('h2', { className: 'text-xl font-bold mb-4' }, selectedProduct?.name),
        React.createElement('p', null, selectedProduct?.description),
        selectedQuantity || isBulkMode ?
          React.createElement('button', { className: 'mt-4 p-4 bg-yellow-500 rounded-xl', onClick: handleOrder }, 'Commander') :
          null
      )
    );

    return React.createElement('div', null,
      currentView === 'home' ? renderHome() : renderProductDetail()
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(TelegramShopApp));
</script>

</body>
</html>
